mxcp: 1
tool:
  name: list_ibx_locations
  description: |
    List distinct IBX locations with line counts and aggregated spend values.
    Use this to see which Dublin data centers (DB1, DB2, DB3) have billing activity and their total spend.
  tags:
    - billing
    - reference
  annotations:
    title: "List IBX Locations"
    readOnlyHint: true
    destructiveHint: false
    idempotentHint: true
    openWorldHint: false
  parameters: []
  return:
    type: array
    description: "One row per IBX location with aggregated spend totals."
    items:
      type: object
      description: "Aggregated billing totals for an IBX location."
      properties:
        ibx:
          type: string
          description: "IBX data center location code (DB1, DB2, DB3)."
        line_count:
          type: integer
          description: "Number of billing line items at this location."
        total_line_amount:
          type: number
          description: "Sum of net line amounts before GST."
        total_gst:
          type: number
          description: "Sum of GST amounts."
        total_amount:
          type: number
          description: "Sum of total amounts including GST."
  source:
    code: |
      SELECT
        ibx,
        CAST(COUNT(*) AS INTEGER) AS line_count,
        ROUND(SUM(line_amount), 2) AS total_line_amount,
        ROUND(SUM(gst_amount), 2) AS total_gst,
        ROUND(SUM(total_amount), 2) AS total_amount
      FROM load_billing_data
      GROUP BY ibx
      ORDER BY ibx
  tests:
    - name: list_all_ibx_locations
      description: "Returns all IBX sites in billing data."
      arguments: []
      result_length: 3
    - name: db2_totals_present
      description: "Includes DB2 location counts."
      arguments: []
      result_contains_item:
        ibx: "DB2"
        line_count: 619
