mxcp: 1
tool:
  name: get_billing_by_category
  description: |
    Get detailed billing lines for a specific product category.
    Use this for line-level review of usage, recurring, and non-recurring charges
    within Power, Interconnection, Services, or Space.
  tags:
    - billing
    - detail
  annotations:
    title: "Billing by Category"
    readOnlyHint: true
    destructiveHint: false
    idempotentHint: true
    openWorldHint: false
  parameters:
    - name: product_category
      type: string
      description: "Billing product category to filter."
      enum: ["Power", "Interconnection", "Services", "Space"]
      examples: ["Power", "Interconnection"]
  return:
    type: array
    description: "Billing line items for the specified product category."
    items:
      type: object
      description: "A single billing transaction line."
      properties:
        trx_number:
          type: string
          description: "Invoice transaction number."
        trx_date:
          type: string
          format: date
          description: "Transaction date (YYYY-MM-DD)."
        product_category:
          type: string
          description: "Product category (matches the filter parameter)."
        charge_type:
          type: string
          description: "Charge type label (RC, NRC, Usage, Reseller Discount)."
        ibx:
          type: string
          description: "IBX data center location code."
        description:
          type: string
          description: "Line item description from the invoice."
        quantity:
          type: number
          description: "Billed quantity."
        unit_price:
          type: number
          description: "Price per unit."
        line_amount:
          type: number
          description: "Net line amount before GST."
        total_amount:
          type: number
          description: "Total amount including GST."
  source:
    code: |
      SELECT
        trx_number,
        trx_date,
        product_category,
        charge_type,
        ibx,
        description,
        quantity,
        unit_price,
        line_amount,
        total_amount
      FROM load_billing_data
      WHERE product_category = $product_category
      ORDER BY trx_date, trx_number
  tests:
    - name: get_power_billing_lines
      description: "Returns all Power category lines."
      arguments:
        - key: product_category
          value: "Power"
      result_length: 84
    - name: interconnection_includes_db2
      description: "Interconnection result includes DB2 records."
      arguments:
        - key: product_category
          value: "Interconnection"
      result_contains_item:
        product_category: "Interconnection"
        ibx: "DB2"
