mxcp: 1
tool:
  name: get_billing_summary
  description: |
    Summarize Vodafone Ireland billing spend by product category and IBX location.
    Returns net line amount, GST, total billed amount, and line counts.
    Use this for a high-level overview of spend distribution across categories and sites.
  tags:
    - billing
    - summary
  annotations:
    title: "Billing Summary"
    readOnlyHint: true
    destructiveHint: false
    idempotentHint: true
    openWorldHint: false
  parameters: []
  return:
    type: array
    description: "Summary rows grouped by product category and IBX location."
    items:
      type: object
      description: "Aggregated billing totals for one category-IBX combination."
      properties:
        product_category:
          type: string
          description: "Billing product category (Power, Interconnection, Services, Space)."
        ibx:
          type: string
          description: "IBX data center location code (DB1, DB2, DB3)."
        total_line_amount:
          type: number
          description: "Sum of net line amounts before GST, rounded to 2 decimal places."
        total_gst:
          type: number
          description: "Sum of GST amounts, rounded to 2 decimal places."
        total_amount:
          type: number
          description: "Sum of total amounts including GST, rounded to 2 decimal places."
        line_count:
          type: integer
          description: "Number of billing line items in this group."
  source:
    code: |
      SELECT
        product_category,
        ibx,
        ROUND(SUM(line_amount), 2) AS total_line_amount,
        ROUND(SUM(gst_amount), 2) AS total_gst,
        ROUND(SUM(total_amount), 2) AS total_amount,
        CAST(COUNT(*) AS INTEGER) AS line_count
      FROM load_billing_data
      GROUP BY product_category, ibx
      ORDER BY product_category, ibx
  tests:
    - name: billing_summary_group_count
      description: "Returns all product category and IBX combinations."
      arguments: []
      result_length: 11
    - name: billing_summary_has_power_db3
      description: "Includes Power records for DB3."
      arguments: []
      result_contains_item:
        product_category: "Power"
        ibx: "DB3"
        line_count: 38
